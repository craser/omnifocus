#!/usr/bin/env osascript -l JavaScript
"use strict";class t{constructor(){this.omnifocus=Application("OmniFocus")}getActiveProject(t){try{var e=this.omnifocus.defaultDocument.flattenedProjects.whose({name:{_beginsWith:t}});for(let t=0;t<e.length;t++){const s=e[t];if(/active/i.test(s.status.get()))return s}return null}catch(t){return console.log(t),null}}getChild(t,e){try{var s=t.tasks.whose({_and:[{name:{_beginsWith:e}},{completed:{_equals:"false"}}]});return s.length?s[0]:null}catch(t){return console.log(t),null}}addTask(t,e){t?t.tasks.push(e):this.omnifocus.defaultDocument.inboxTasks.push(e)}createTask(t){return this.omnifocus.Task(t)}addTags(t,e){this.omnifocus.add(t,{to:e.tags})}getTag(t){try{return this.omnifocus.defaultDocument.tags.whose({name:{_beginsWith:t}})[0]()}catch(t){return null}}createTag(t){var e=this.omnifocus.Tag({name:t});return this.omnifocus.defaultDocument.tags.push(e),e}}try{!function(){const e={name:`test task ${new Date}`,note:"this is a test task"};let s=new t;const o=s.createTask(e);s.addTask(null,o),console.log("task created")}(),function(){const e=(new t).getActiveProject("bogus project");console.log(`found project?: ${!!e}`),console.log(`project name: ${e.name.get()} (${e.status.get()})`)}(),function(){const e={name:`test task in project ${new Date}`,note:"this is a test task"},s=(new t).getActiveProject("bogus project");let o=new t,n=o.createTask(e);o.addTask(s,n),console.log("task created")}(),function(){let e=new t;const s=e.getActiveProject("bogus project"),o=e.getChild(s,"subtask");console.log(`subtask name: ${o.name.get()}`)}(),function(){const e={name:`test sub-sub-task in project ${new Date}`,note:"this is a test task"};let s=new t,o=s.getActiveProject("bogus"),n=s.getChild(o,"subtask"),a=s.createTask(e),c=s.addTask(n,a);console.log(`sub-sub-task created: ${!!c}`)}()}catch(t){console.log(`error testing OmniFocus abstraction layer: ${t}`),console.log(t)}
