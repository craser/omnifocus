#!/Users/craser/.nvm/versions/node/v10.23.0/bin/node

const { exec } = require('child_process');
const TaskParser = require('./js/TaskParser');

function shell(cmd, f) {
    exec(cmd, function (error, stdout, stderr) {
        f(stdout.trim());
    });
}

function createOmniFocusTask(task) {
    var json = JSON.stringify(task);
    console.log(`json: ${json}`);
    shell(`json-to-task '${json}'`, function (text) {
        console.log(text);
    })
}

function run(argv) {
    try {
        console.log('################################################################################');
        console.log(`creating new task: ${new Date()}`);
        console.log(`input: "${argv[0]}"`);
        var string = argv[0];
        var task = new TaskParser().parseTask(string);
        createOmniFocusTask(task);
        console.log('task created');
    } catch (e) {
        console.log(`error creating task: ${e}`);
        console.log(e);
    }
}

run(process.argv.slice(2));
